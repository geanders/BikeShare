---
title: "Variable Selection"
author: "Brooke Anderson"
date: "February 29, 2016"
output: pdf_document
---

```{r message = FALSE}
knitr::opts_knit$set(root.dir = "..") # Reset root directory for analysis
library(lubridate) # To help handle dates
library(dplyr) # Data wrangling
library(ggplot2) # Plotting
```

Read in and clean up the data:

```{r}
train <- read.csv("data/train.csv", as.is = TRUE) # `as.is` so `datetime` comes in as
                                                  # character, not factor
test <- read.csv("data/test.csv", as.is = TRUE)

train <- mutate(train,
                datetime = ymd_hms(datetime),
                year = factor(year(datetime)),
                hour = factor(hour(datetime)),
                month = month(datetime),
                yday = yday(datetime),
                weather = factor(weather, levels = c(1, 2, 3, 4),
                                 labels = c("Clear", "Mist", "Light Precip",
                                            "Heavy Precip")),
                season = factor(season, levels = c(1, 2, 3, 4),
                                labels = c("Spring", "Summer", "Fall", "Winter")),
                workingday = factor(workingday, levels = c(0, 1),
                                    labels = c("Holiday / weekend",
                                               "Working day")))
test  <- mutate(test,
                datetime = ymd_hms(datetime),
                year = factor(year(datetime)),
                hour = factor(hour(datetime)),
                month = month(datetime),
                yday = yday(datetime),
                weather = factor(weather, levels = c(1, 2, 3, 4),
                                 labels = c("Clear", "Mist", "Light Precip",
                                            "Heavy Precip")),
                season = factor(season, levels = c(1, 2, 3, 4),
                                labels = c("Spring", "Summer", "Fall", "Winter")),
                workingday = factor(workingday, levels = c(0, 1),
                                    labels = c("Holiday / weekend",
                                               "Working day")))
```

Add some derived variables related to weather and temperature, using `dplyr` for data wrangling ([here's a good cheatsheet](http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)).

First, create some lagged variables for `temp` and `weather`:

```{r}
train <- mutate(train,
                temp1 = lag(temp, 1),
                temp2 = lag(temp, 2),
                temp3 = lag(temp, 3),
                temp4 = lag(temp, 4),
                temp5 = lag(temp, 5),
                weather1 = lag(weather, 1),
                weather2 = lag(weather, 2),
                weather3 = lag(weather, 3),
                weather4 = lag(weather, 4),
                weather5 = lag(weather, 5))
```

Next, create some variables by day. For example, was there one or more hours of bad weather during the day? You can get these by grouping by day (`group_by`), using `mutate` to calculate the by-day summary, and then ungrouping (`ungroup`).

```{r}
train <- group_by(train, format(datetime, "%Y%m%d")) %>%
  mutate(mean_daily_temp = mean(temp),
         morning_temp = mean(temp[hour %in% c("6", "7", "8")])) %>%
  ungroup()
```

You can see that these values are constant within a day: 

```{r}
ggplot(train[1:(4*24), ], aes(x = datetime, y = morning_temp)) + 
  geom_line() + 
  theme_minimal()
```

